<!DOCTYPE HTML>
<html manifest="" lang="en-US">
<head>
    <meta charset="UTF-8">
    <title>Cheers</title>
 

    <script src="cordova-2.2.0.js"></script>
    <script src="cdv-plugin-fb-connect.js"></script>
    <script src="facebook_js_sdk.js"></script>
    <script src="sencha-touch-all.js"></script> 
    <script src="http://debug.phonegap.com/target/target-script-min.js#hagok1234"></script>
    <link rel="stylesheet" type="text/css"   href="apple.css">
    <style>
        .bumpStatus{
            text-align:right;
            width:100%;font-size:8px;
        }
    </style>
    <script src="app.js"></script> 
    <script>
    var API_URL = 'http://cheers.phpwebbies.com';
    var USER_ID = window.localStorage.getItem("USER_ID");
    var BUMP_STATUS = '';
    var BUMP_LOCKED = false;
    var BUMP_CONNECTED = false;
    
    
    document.addEventListener('deviceready', function() {
       try {
       
       FB.init({ appId: "216450108488349", nativeInterface: CDV.FB, useCachedDialogs: false });
       //document.getElementById('data').innerHTML = "";
       } catch (e) {
       alert(e);
       }
    }, false);

        
    if ((typeof cordova == 'undefined') && (typeof Cordova == 'undefined')) alert('Cordova variable does not exist. Check that you have included cordova.js correctly');
    if (typeof CDV == 'undefined') alert('CDV variable does not exist. Check that you have included cdv-plugin-fb-connect.js correctly');
    if (typeof FB == 'undefined') alert('FB variable does not exist. Check that you have included the Facebook JS SDK file.');

    FB.Event.subscribe('auth.login', function(response) {
                     //   alert('auth.login event');

                       });

    FB.Event.subscribe('auth.logout', function(response) {
                    // alert('auth.logout event');
                       });

    FB.Event.subscribe('auth.sessionChange', function(response) {
                    // alert('auth.sessionChange event');
                       });

    FB.Event.subscribe('auth.statusChange', function(response) {
                      // alert('auth.statusChange event');
                       });

     

   
            var friendIDs = [];
			var fdata;
            function me() {
                FB.api('/me/friends', { fields: 'id, name, picture' },  function(response) {
                       if (response.error) {
                       alert(JSON.stringify(response.error));
                       } else {
                       var data = document.getElementById('data');
					   fdata=response.data;
					   console.log("fdata: "+fdata);
                       response.data.forEach(function(item) {
                                             var d = document.createElement('div');
                                             d.innerHTML = "<img src="+item.picture+"/>"+item.name;
                                             data.appendChild(d);
                                             });
                       }
					var friends = response.data;
					console.log(friends.length); 
					for (var k = 0; k < friends.length && k < 200; k++) {
				        var friend = friends[k];
				        var index = 1;

				        friendIDs[k] = friend.id;
				        //friendsInfo[k] = friend;
					}
					console.log("friendId's: "+friendIDs);
                       });
            }
            
            function logout() {
                alert(2);
                FB.logout(function(response) {
                          alert('logged out');
                          });
            }
            
            function login() {
                FB.login(
                         function(response) {
                         if (response.session) {
                         alert('logged in');
                         } else {
                         alert('not logged in');
                         }
                         },
                         { scope: "email" }
                         );
            }
			
			
			function facebookWallPost() {
			    console.log('Debug 1');
				var params = {
				    method: 'feed',
				    name: 'Facebook Dialogs',
				    link: 'https://developers.facebook.com/docs/reference/dialogs/',
				    picture: 'http://fbrell.com/f8.jpg',
				    caption: 'Reference Documentation',
				    description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
				  };
				console.log(params);
			    FB.ui(params, function(obj) { console.log(obj);});
			}
            
			function publishStoryFriend() {
				randNum = Math.floor ( Math.random() * friendIDs.length ); 

				var friendID = friendIDs[randNum];
				if (friendID == undefined){
					alert('please click the me button to get a list of friends first');
				}else{
			    	console.log("friend id: " + friendID );
			        console.log('Opening a dialog for friendID: ', friendID);
			        var params = {
			        	method: 'feed',
			            to: friendID.toString(),
			            name: 'Facebook Dialogs',
			            link: 'https://developers.facebook.com/docs/reference/dialogs/',
			            picture: 'http://fbrell.com/f8.jpg',
			            caption: 'Reference Documentation',
			            description: 'Dialogs provide a simple, consistent interface for applications to interface with users.'
			     	};
					FB.ui(params, function(obj) { console.log(obj);});
			    }
			}
            
           
            
            window.bump = function(str, callback) {
                cordova.exec(callback, function(err) {
                             callback('Nothing to echo.');
                             }, "Bump", "bump", [str]);
            };

            function bumpTest(){
            document.getElementById( "log" ).innerHTML = 'Please wait starting connection...'+ '<br>'+document.getElementById( "log" ).innerHTML +'<BR>';
                
            window.bump("echome", function(echoValue) {
                        alert(echoValue == "echome"); // should alert true.
                        });
            }
            
            
            function updateContent( data ) {
               // location.href='#bump/'+data;
                
               // Cheers.getApplication().getController('Main').test1();
                
                Cheers.app.getControllerInstances()['Cheers.controller.Main'].bumpStatus(data);
               // Ext.msg.alert('bump',data);
                //console.log('the app='+Cheers)
                //Cheers.controller.main.test1();
                //Ext.Msg.alert('Bump', data);
                //Ext.ControllerManager.get('mainControler').test1({});
                
                  //alert(data);               
                //document.getElementById( "log" ).innerHTML = data+ '<br>'+document.getElementById( "log" ).innerHTML +'<BR>';
             }
             
           
     </script>
</head>
<body>
    <div id="appLoadingIndicator">
        <div></div>
        <div></div>
        <div></div>
    </div>
</body>
</html>
